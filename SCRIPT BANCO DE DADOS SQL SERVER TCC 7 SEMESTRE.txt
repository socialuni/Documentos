IF NOT EXISTS(SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'USUARIO' AND O.TYPE = 'U') 
BEGIN
CREATE TABLE USUARIO
(
	  ID_USUARIO INT IDENTITY NOT NULL
	, NOME VARCHAR(255) NOT NULL
	, EMAIL VARCHAR(255) NOT NULL
	, SENHA VARCHAR(30) NOT NULL
	, SEXO VARCHAR(1)  NOT NULL
	, CPF VARCHAR(14) NOT NULL 
	, DT_NASCIMENTO DATE NOT NULL
	, TELEFONE DATETIME NOT NULL
	, PERFIL VARCHAR(255) NOT NULL
	, ID_HABILIDADE INT NOT NULL FOREIGN KEY REFERENCES HABILIDADE(ID_HABILIDADE)
	, ID_PREFERENCIA INT NOT NULL FOREIGN KEY REFERENCES PREFERENCIA(ID_PREFERENCIA)
	, ID_CURSO INT NOT NULL FOREIGN KEY REFERENCES CURSO(ID_CURSO)
	

	PRIMARY KEY CLUSTERED 
		(
		[ID_USUARIO] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
	) ON [PRIMARY]

END 
GO

IF NOT EXISTS(SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'PROFESSOR' AND O.TYPE = 'U') 
BEGIN
CREATE TABLE PROFESSOR
(
  ID_USUARIO INT NOT NULL
, NO_INSC VARCHAR(50) NOT NULL

PRIMARY KEY CLUSTERED 
(
[ID_USUARIO] ASC,
[NO_INSC] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

END 
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'ALUNO' AND O.TYPE = 'U')
BEGIN
CREATE TABLE ALUNO (
 ID_USUARIO INT NOT NULL FOREIGN KEY REFERENCES USUARIO(ID_USUARIO)
,RA INT NOT NULL PRIMARY KEY
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'CURSO' AND O.TYPE = 'U')
BEGIN
CREATE TABLE CURSO (
 ID_CURSO INT NOT NULL PRIMARY KEY
, NOME VARCHAR(150) NOT NULL
, CAMPUS VARCHAR(150) NOT NULL
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'PREFERENCIA' AND O.TYPE = 'U')
BEGIN
CREATE TABLE PREFERENCIA (
  ID_PREFERENCIA INT NOT NULL PRIMARY KEY
, DESCRICAO VARCHAR(150) NOT NULL
, ID_CATEGORIA INT NOT NULL FOREIGN KEY REFERENCES CATEGORIA(ID_CATEGORIA)
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'HABILIDADE' AND O.TYPE = 'U')
BEGIN
CREATE TABLE HABILIDADE(
 ID_HABILIDADE INT NOT NULL PRIMARY KEY
,DESCRICAO VARCHAR(150) NOT NULL
,ID_CATEGORIA INT NOT NULL FOREIGN KEY REFERENCES CATEGORIA(ID_CATEGORIA)
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'CATEGORIA' AND O.TYPE = 'U')
BEGIN
CREATE TABLE CATEGORIA (
ID_CATEGORIA INT NOT NULL PRIMARY KEY
,DESCRICAO VARCHAR(150) NOT NULL
)
END
GO


IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'USUARIO_PREFERENCIA' AND O.TYPE = 'U')
BEGIN
CREATE TABLE USUARIO_PREFERENCIA (
 ID_USUARIO INT NOT NULL FOREIGN KEY REFERENCES USUARIO(ID_USUARIO)
,ID_PREFERENCIA INT NOT NULL FOREIGN KEY REFERENCES PREFERENCIA(ID_PREFERENCIA)
,
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'USUARIO_HABILIDADE' AND O.TYPE = 'U')
BEGIN
CREATE TABLE USUARIO_HABILIDADE (
 ID_USUARIO INT NOT NULL FOREIGN KEY REFERENCES USUARIO(ID_USUARIO)
,ID_HABILIDADE INT NOT NULL FOREIGN KEY REFERENCES HABILIDADE(ID_HABILIDADE)
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'USUARIO_CURSO' AND O.TYPE = 'U')
BEGIN
CREATE TABLE USUARIO_CURSO (
 ID_USUARIO INT NOT NULL FOREIGN KEY REFERENCES USUARIO(ID_USUARIO)
,ID_CURSO INT NOT NULL FOREIGN KEY REFERENCES CURSO(ID_CURSO)
)
END
GO


IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'LOG' AND O.TYPE = 'U')
BEGIN
CREATE TABLE LOG (
 ID_USUARIO INT NOT NULL FOREIGN KEY REFERENCES USUARIO(ID_USUARIO)
,ID_ADMINISTRADOR INT NOT NULL FOREIGN KEY REFERENCES USUARIO_ADMINISTRADOR(ID_ADMINISTRADOR)
,DATA VARCHAR(50) NOT NULL
,HORARIO VARCHAR(50) NOT NULL
,DESCRICAO_ACAO VARCHAR(500)
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'LOG_ERRO' AND O.TYPE = 'U')
BEGIN
CREATE TABLE LOG_ERRO (
 ID_USUARIO INT NOT NULL FOREIGN KEY REFERENCES USUARIO(ID_USUARIO)
,ID_ADMINISTRADOR INT NOT NULL FOREIGN KEY REFERENCES USUARIO_ADMINISTRADOR(ID_ADMINISTRADOR)
,DATA VARCHAR(50) NOT NULL
,HORARIO VARCHAR(50) NOT NULL
,DESCRICAO_ACAO VARCHAR(500) NOT NULL
,DESCRICAO_ERRO VARCHAR(MAX) NOT NULL
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'USUARIO_ADMINISTRADOR' AND O.TYPE = 'U')
BEGIN
CREATE TABLE USUARIO_ADMINISTRADOR (
 ID_ADMINISTRADOR INT NOT NULL PRIMARY KEY
,NOME VARCHAR(150) NOT NULL
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'ATIVIDADE' AND O.TYPE = 'U')
BEGIN
CREATE TABLE ATIVIDADE (
 ID_ATIVIDADE INT NOT NULL PRIMARY KEY
,NOME VARCHAR(255) NOT NULL
,DESCRICAO VARCHAR(MAX) NOT NULL
,AREA VARCHAR(150) NOT NULL
,DATA DATE NOT NULL
,HORARIO TIME NOT NULL
,INFO_ADICIONAL VARCHAR(MAX) NOT NULL

)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'VAGA' AND O.TYPE = 'U')
BEGIN
CREATE TABLE VAGA(
 ID_VAGA INT NOT NULL PRIMARY KEY
,ID_ATIVIDADE INT NOT NULL FOREIGN KEY REFERENCES ATIVIDADE(ID_ATIVIDADE)
,NOME_ATIVIDADE VARCHAR(255) NOT NULL
,DESCRICAO VARCHAR(255) NOT NULL
,NUMEROMAX_INSCRICOES INT NOT NULL
)
END
GO

IF NOT EXISTS (SELECT 1 FROM SYS.OBJECTS O WHERE O.NAME = 'VAGA_USUARIO' AND O.TYPE = 'U')
BEGIN
CREATE TABLE VAGA_USUARIO(
 ID_VAGA INT NOT NULL FOREIGN KEY REFERENCES VAGA(ID_VAGA)
,ID_USUARIO INT NOT NULL FOREIGN KEY REFERENCES USUARIO(ID_USUARIO)
)
END
GO





SELECT CURRENT_TIMESTAMP 